<section class="body">
  <div class="content">
    <div class="header-wrap">
      <div nz-row nzGutter="16" nzAlign="middle" nzJustify="start">
        <div nz-col nzFlex="0 1 250px">
          <input nz-input placeholder="按名字查找" [(ngModel)]="segmentFilter.name" (ngModelChange)="onSearch()"/>
        </div>
        <div nz-col nzFlex="end" style="margin-left: auto">
          <button nz-button nzType="primary" (click)="addSwitch()">
            <i nz-icon nzType="plus" nzTheme="outline"></i>
            新建
          </button>
        </div>
      </div>

      <div class="data-list">
        <nz-table #table nzSize="small"
                  nzShowSizeChanger
                  [nzScroll]="{ y: '520px' }"
                  [nzData]="segmentListModel.items"
                  [nzFrontPagination]="false"
                  [nzLoading]="loading"
                  [nzTotal]="segmentListModel.totalCount"
                  [(nzPageSize)]="segmentFilter.pageSize"
                  (nzPageSizeChange)="onSearch()"
                  [nzPageSizeOptions]="[10,20,30]"
                  [(nzPageIndex)]="segmentFilter.pageIndex"
                  (nzPageIndexChange)="onSearch()">
          <thead>
          <tr class="table-th-style">
            <th>名称</th>
            <th>最近修改</th>
            <th nzAlign="center">操作</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let item of table.data">
            <td style="cursor: pointer;" (click)="onIntoSegmentDetail(theSwitch)">{{item.name}}</td>
            <td>{{getLocalDate(item.lastModificationTime) | date: 'YYYY-MM-dd HH:mm:ss'}}</td>
            <td style="text-align: center">
              <a nz-button nzType="link" style="color: #9A95CC;" (click)="onIntoSwitchDetail(item)">详情</a>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </div>
    </div>
  </div>
</section>

<nz-modal [(nzVisible)]="createModalVisible"
          [nzTitle]="modalTitle"
          [nzCentered]="true"
          [nzContent]="modalContent"
          [nzFooter]="modalFooter"
          (nzOnCancel)="this.closeCreateModal()">

  <ng-template #modalTitle>新建用户组</ng-template>

  <ng-template #modalContent>
    <form nz-form [formGroup]="segmentForm">
      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired>名称</nz-form-label>
        <nz-form-control [nzSpan]="14" nzHasFeedback nzValidatingTip="校验中..." [nzErrorTip]="segmentNameErrorTpl">
          <input nz-input formControlName="name" />
          <ng-template #segmentNameErrorTpl let-control>
            <ng-container *ngIf="control.hasError('required')">名称必填</ng-container>
            <ng-container *ngIf="control.hasError('invalid_character')">名称不能包含 '__'</ng-container>
            <ng-container *ngIf="control.hasError('duplicated')">该名称已被使用</ng-container>
            <ng-container *ngIf="control.hasError('unknown')">名称校验失败</ng-container>
          </ng-template>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired>KeyName</nz-form-label>
        <nz-form-control [nzSpan]="14" nz-tooltip nzTooltipTitle="用于获取 variation 值">
          <input nz-input [value]="this.segmentForm.get('name').value | switchKeyName" formControlName="keyName" placeholder="由名称自动生成" />
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired>描述</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <textarea nz-input  formControlName="description" placeholder="描述" [nzAutosize]="{ minRows: 3, maxRows: 5 }"></textarea>
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-template>

  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="this.closeCreateModal()">取消</button>
    <button nz-button nzType="primary" [nzLoading]="this.creating" [disabled]="!segmentForm.valid" (click)="createSegment()">创建</button>
  </ng-template>
</nz-modal>
